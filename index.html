<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abyss Rift - La Llamada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Cormorant+Garamond:ital,wght@0,400;0,700;1,400&family=Metamorphous&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0f172a;
            --bg-magic: #1e1b4b;
            --parchment-light: #fdf6e3; 
            --gold-accent: #b45309;
            --text-main: #1a120b;
        }

        body {
            background: radial-gradient(circle at center, #2e1065, #0f172a);
            color: var(--text-main);
            font-family: 'Cormorant Garamond', serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        .magic-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
        .particle { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(255, 255, 255, 0.8); animation: floatUp 15s infinite linear; }
        @keyframes floatUp { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 20% { opacity: 1; } 100% { transform: translateY(-10vh) scale(1.5); opacity: 0; } }

        h1, h2, h3, .title-font { font-family: 'Metamorphous', cursive; letter-spacing: 0.05em; }
        .elegant-serif { font-family: 'Cinzel', serif; }

        .slide { display: none; height: 100vh; width: 100vw; flex-direction: column; justify-content: center; align-items: center; padding: 1rem; position: relative; z-index: 10; }
        .slide.active { display: flex; animation: majesticFadeIn 0.8s ease-out forwards; }
        @keyframes majesticFadeIn { from { opacity: 0; transform: scale(0.95) translateY(20px); filter: blur(5px); } to { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); } }

        .parchment {
            background: var(--parchment-light);
            background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            padding: 3rem; /* Aumentado padding */
            max-width: 1000px; /* Aumentado ancho m√°ximo para acomodar texto m√°s grande */
            width: 95%;
            border-radius: 12px;
            box-shadow: 0 0 0 4px #b48c36 inset, 0 0 0 6px #5c4033 inset, 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 40px rgba(212, 175, 55, 0.2);
            position: relative;
            border: 1px solid #d4c5a3;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .gem { position: absolute; width: 24px; height: 24px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #60a5fa, #1e3a8a); border: 2px solid #d4af37; box-shadow: 0 0 10px rgba(59, 130, 246, 0.6); z-index: 10; }
        .tl { top: 12px; left: 12px; } .tr { top: 12px; right: 12px; } .bl { bottom: 12px; left: 12px; } .br { bottom: 12px; right: 12px; }

        .btn-magic {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #d4af37;
            border: 1px solid #d4af37;
            padding: 14px 35px; /* Botones m√°s grandes */
            font-size: 1.1rem; /* Texto bot√≥n m√°s grande */
            font-family: 'Cinzel', serif;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        .btn-magic:hover { transform: translateY(-2px); color: #fcd34d; border-color: #fcd34d; }

        .divider { display: flex; align-items: center; justify-content: center; margin: 1.5rem 0; opacity: 0.9; color: #854d0e; font-size: 1.5rem; }
        .divider::before, .divider::after { content: ''; height: 2px; background: linear-gradient(90deg, transparent, #854d0e, transparent); flex: 1; margin: 0 15px; }

        /* Aumentado tama√±o de fuente inputs y labels */
        .magic-label { display: block; font-family: 'Cinzel', serif; font-size: 1.1rem; font-weight: bold; color: #7c2d12; margin-bottom: 0.4rem; text-transform: uppercase; }
        .magic-input, .magic-select { background: rgba(255, 255, 255, 0.9); border: 2px solid #b45309; padding: 10px 14px; width: 100%; font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; font-weight: 600; color: #1a120b; outline: none; border-radius: 4px; }
        
        .slot-row { padding: 10px 0; border-bottom: 1px solid rgba(180, 83, 9, 0.2); font-family: 'Cormorant Garamond', serif; display: flex; align-items: center; transition: all 0.5s ease; }
        .slot-empty { color: #a8a29e; font-style: italic; opacity: 0.7; font-size: 1.2rem; }
        .highlight-text { color: #7c2d12; font-weight: bold; border-bottom: 2px solid rgba(180, 83, 9, 0.5); }
        .disclaimer-box { background-color: rgba(234, 179, 8, 0.15); border-left: 4px solid #b45309; padding: 10px; font-size: 1rem; color: #451a03; margin-top: 5px; line-height: 1.4; }

        /* Scrollbar personalizado */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #b45309; border-radius: 20px; }

        /* Loader */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #b45309; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="magic-bg" id="particles"></div>

    <!-- SLIDE 1 (Portada - Mantenida igual) -->
    <div class="slide active" id="slide-1">
        <div class="parchment text-center">
            <div class="gem tl"></div><div class="gem tr"></div><div class="gem bl"></div><div class="gem br"></div>
            <p class="text-sm font-bold uppercase tracking-[0.4em] mb-4 text-[#7c2d12] elegant-serif">Llamamiento Oficial</p>
            <h1 class="text-5xl md:text-7xl mb-2 title-font text-[#2e1065] drop-shadow-md">Abyss Rift</h1>
            <h2 class="text-xl md:text-2xl mb-6 elegant-serif text-[#1e3a8a] font-bold tracking-wider">‚Äî La Guardia del Alba ‚Äî</h2>
            <div class="divider">‚öúÔ∏è</div>
            <p class="text-xl italic mb-8 font-serif leading-relaxed text-[#1a120b] font-semibold">
                Saludos, viajero. El mundo pende de un hilo y una antigua Voz busca campeones.<br>
                <span class="text-[#1e40af]">¬øTen√©is el valor para enfrentaros a la oscuridad?</span>
            </p>
            <button class="btn-magic" onclick="nextSlide(2)">Ver el Contrato</button>
        </div>
    </div>

    <!-- SLIDE 2 (Aumentado tama√±o) -->
    <div class="slide" id="slide-2">
        <h2 class="text-5xl text-[#fef3c7] mb-8 title-font text-center drop-shadow-md">Arte y Hogar</h2>
        <div class="parchment">
            <div class="gem tl"></div><div class="gem tr"></div><div class="gem bl"></div><div class="gem br"></div>
            <div class="flex flex-col md:flex-row gap-8 items-center justify-center h-full">
                <div class="text-[8rem] drop-shadow-lg hidden md:block">üè∞</div>
                <div>
                    <h3 class="text-4xl font-bold mb-4 title-font text-[#1e3a8a] border-b border-[#b45309] inline-block">Tu Refugio</h3>
                    <p class="mb-6 text-2xl text-[#2c241b] font-medium leading-relaxed">No todo es guerra. Si deseas dise√±ar la torre perfecta o una caba√±a junto al lago... <span class="highlight-text">hazlo.</span></p>
                    <div class="bg-[#fff7ed] p-6 rounded border-l-4 border-[#b45309]">
                        <p class="text-sm font-bold text-[#9a3412] uppercase mb-1">Nota del Cronista:</p>
                        <p class="italic text-[#431407] text-xl">"Existe un <strong>Final Can√≥nico</strong>. Construye por la belleza del momento."</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-8"><button class="btn-magic" onclick="nextSlide(3)">Continuar</button></div>
    </div>

    <!-- SLIDE 3 (Aumentado tama√±o) -->
    <div class="slide" id="slide-3">
        <h2 class="text-5xl text-[#fef3c7] mb-8 title-font text-center drop-shadow-md">C√≥digo de Honor</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-6xl px-4">
            <div class="parchment text-center" style="padding: 2.5rem;">
                <h3 class="text-3xl font-bold title-font text-[#15803d]">Caza Libre</h3>
                <div class="text-6xl my-4">üèπ</div>
                <p class="text-xl font-medium mb-4">¬øExplorar, recolectar, mazmorras peque√±as?</p>
                <div class="bg-green-100 p-3 rounded border border-green-700 text-green-900 font-bold text-xl">¬°ADELANTE!</div>
            </div>
            <div class="parchment text-center" style="padding: 2.5rem;">
                <h3 class="text-3xl font-bold title-font text-[#be123c]">La Campa√±a</h3>
                <div class="text-6xl my-4">üê≤</div>
                <p class="text-xl font-medium mb-4">Jefes de Historia y Eventos Principales.</p>
                <div class="bg-red-100 p-3 rounded border border-red-800 text-[#be123c] font-bold text-xl">SOLO EN GRUPO</div>
            </div>
        </div>
        <div class="mt-8"><button class="btn-magic" onclick="nextSlide(4)">La Zona Prohibida</button></div>
    </div>

    <!-- SLIDE 4 (Aumentado tama√±o) -->
    <div class="slide" id="slide-4">
        <div class="parchment text-center" style="border: 3px solid #7f1d1d; background: #fff5f5;">
            <div class="gem tl"></div><div class="gem tr"></div><div class="gem bl"></div><div class="gem br"></div>
            <h2 class="text-5xl font-black text-[#9f1239] mb-6 uppercase title-font">‚ö†Ô∏è El Borde del Mundo ‚ö†Ô∏è</h2>
            <div class="mb-8 border-y-2 border-[#9f1239] py-3 inline-block">
                <p class="text-3xl font-bold elegant-serif text-[#7f1d1d]">L√≠mite: Radio de 625 Chunks</p>
            </div>
            <p class="text-2xl mb-8 text-[#4a044e] font-bold">M√°s all√°, la realidad colapsa. No cruces la l√≠nea.</p>
            <div class="bg-[#2e1065] text-white p-6 rounded text-left mx-auto max-w-2xl">
                <ul class="space-y-4 text-xl">
                    <li>‚ö° El servidor colapsar√° para todos.</li>
                    <li>üï∏Ô∏è Tu personaje quedar√° en el limbo.</li>
                    <li class="text-red-300 font-bold">üíÄ Borraremos tu inventario para salvar el server.</li>
                </ul>
            </div>
            <div class="mt-8"><button class="btn-magic" style="border-color:#9f1239; color:#9f1239" onclick="nextSlide(5)">Entendido</button></div>
        </div>
    </div>

    <!-- SLIDE 5: FIREBASE LOGIC (Aumentado tama√±o) -->
    <div class="slide" id="slide-5">
        <h2 class="text-6xl text-[#fef3c7] mb-4 title-font text-center drop-shadow-md">El Pacto Final</h2>
        <div class="parchment flex flex-col items-center" style="max-width: 800px; padding: 3rem;">
            <div class="gem tl"></div><div class="gem tr"></div>
            
            <div class="text-center w-full mb-6">
                <p class="uppercase font-bold text-sm tracking-[0.3em] text-[#854d0e] mb-2">Primera Reuni√≥n</p>
                <p class="text-4xl font-bold elegant-serif text-[#1e1b4b]">10 de Enero de 2026</p>
            </div>

            <!-- TABLA DE JUGADORES -->
            <div id="roster-display" class="w-full mb-8 bg-white/50 border border-[#b45309] rounded p-6 shadow-inner">
                 <h3 class="text-2xl font-bold mb-4 text-center title-font text-[#1e3a8a] border-b border-[#b45309]/30 pb-3">‚ùñ Los 8 Elegidos ‚ùñ</h3>
                 
                 <div id="db-loader" class="loader"></div>

                 <!-- Contenedor de la lista m√°s alto -->
                 <div id="slots-container" class="space-y-2 max-h-[250px] overflow-y-auto pr-4 custom-scrollbar hidden">
                    <!-- SE LLENA CON JAVASCRIPT -->
                 </div>
            </div>

            <!-- FORMULARIO -->
            <div id="signup-form" class="w-full hidden">
                <div class="input-group">
                    <label class="magic-label">Nombre de Minecraft (Copia y Pega)</label>
                    <input type="text" id="username" class="magic-input" placeholder="Ej: SteveGamer99">
                    <div class="disclaimer-box">
                        <strong>‚ö†Ô∏è CR√çTICO:</strong> Copia el nombre <u>exacto</u>. Si fallas una letra, la Whitelist no te dejar√° entrar.
                    </div>
                </div>

                <div class="input-group mt-6">
                    <label class="magic-label">Especializaci√≥n</label>
                    <select id="user-class" class="magic-select">
                        <option value="Tanque">üõ°Ô∏è Tanque</option>
                        <option value="Mago">‚ú® Mago</option>
                        <option value="Curador">üåø Curador</option>
                        <option value="Guerrero">‚öîÔ∏è Guerrero</option>
                        <option value="Explorador">üèπ Explorador</option>
                    </select>
                    <p class="text-sm text-[#7c2d12] mt-2 italic font-semibold">* Solo referencia, puedes cambiar en el juego.</p>
                </div>

                <div class="text-center w-full mt-8">
                    <button id="join-btn" class="w-full text-xl bg-gradient-to-r from-[#1e3a8a] to-[#1e40af] text-white py-4 px-8 rounded shadow-lg elegant-serif border border-[#60a5fa] flex items-center justify-center gap-3" onclick="submitToFirebase()">
                        <span class="text-2xl">‚úíÔ∏è</span> <span class="tracking-widest font-bold">RECLAMAR LUGAR</span>
                    </button>
                    <p id="error-msg" class="text-red-700 font-bold text-lg mt-3 hidden"></p>
                </div>
            </div>
            
            <div id="full-msg" class="hidden text-center text-red-800 font-bold text-2xl mt-6 border-4 border-red-800 p-6 rounded bg-red-100">
                ‚õî LOS 8 CUPOS EST√ÅN LLENOS ‚õî
            </div>
        </div>
    </div>

    <!-- FIREBASE CONFIGURATION & LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBlFU5LPrhbOy4Vn5uxXjKXsAJbvLVwDHo",
            authDomain: "abyssrift-d7953.firebaseapp.com",
            projectId: "abyssrift-d7953",
            storageBucket: "abyssrift-d7953.firebasestorage.app",
            messagingSenderId: "947324202474",
            appId: "1:947324202474:web:cabae07082cb33a317d693",
            measurementId: "G-DEK7N7G4X5"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            listenToSlots(); 
        } catch (e) {
            console.error("Error al conectar Firebase", e);
            document.getElementById('db-loader').style.display = 'none';
            document.getElementById('slots-container').innerHTML = "<p class='text-red-500 text-center font-bold text-xl'>Error de conexi√≥n.</p>";
            document.getElementById('slots-container').classList.remove('hidden');
        }

        function listenToSlots() {
            const docRef = doc(db, "server_data", "roster");
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    renderSlots(data.slots);
                } else {
                    console.log("No existe el documento.");
                    document.getElementById('db-loader').style.display = 'none';
                }
            });
        }

        function renderSlots(slotsData) {
            const container = document.getElementById('slots-container');
            const form = document.getElementById('signup-form');
            const loader = document.getElementById('db-loader');
            const fullMsg = document.getElementById('full-msg');
            
            container.innerHTML = '';
            let isFull = true;

            slotsData.forEach((slot, index) => {
                const num = romanize(index + 1);
                const div = document.createElement('div');
                div.className = "slot-row";
                
                if (slot.name && slot.name !== "") {
                    // Slot Ocupado (Texto m√°s grande)
                    div.innerHTML = `
                        <span class="font-bold text-[#b45309] w-10 font-serif text-2xl">${num}.</span>
                        <span class="text-2xl font-bold font-serif italic text-[#1a120b] truncate mr-2">${slot.name}</span>
                        <span class="ml-auto text-sm font-bold text-[#1e3a8a] bg-blue-100 px-3 py-1 rounded-full uppercase tracking-wider border border-blue-200 whitespace-nowrap">${slot.role}</span>
                    `;
                } else {
                    // Slot Vac√≠o
                    isFull = false;
                    div.innerHTML = `
                        <span class="font-bold text-[#a8a29e] w-10 font-serif text-2xl">${num}.</span>
                        <span class="slot-empty">‚úß Ecos del Vac√≠o ‚úß</span>
                    `;
                }
                container.appendChild(div);
            });

            loader.style.display = 'none';
            container.classList.remove('hidden');

            if (isFull) {
                form.classList.add('hidden');
                fullMsg.classList.remove('hidden');
            } else {
                form.classList.remove('hidden');
                fullMsg.classList.add('hidden');
            }
        }

        window.submitToFirebase = async function() {
            const nameInput = document.getElementById('username');
            const roleSelect = document.getElementById('user-class');
            const btn = document.getElementById('join-btn');
            const errorMsg = document.getElementById('error-msg');
            
            const name = nameInput.value.trim();
            const role = roleSelect.value;

            if (!name) {
                alert("Por favor, escribe tu nombre.");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Firmando el pacto...";
            errorMsg.classList.add('hidden');

            try {
                const docRef = doc(db, "server_data", "roster");
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    let currentSlots = docSnap.data().slots;
                    const emptyIndex = currentSlots.findIndex(s => s.name === "");
                    
                    if (emptyIndex !== -1) {
                        currentSlots[emptyIndex] = { name: name, role: role };
                        await updateDoc(docRef, { slots: currentSlots });
                        alert("¬°Bienvenido a la Guardia, " + name + "!");
                        nameInput.value = "";
                    } else {
                        errorMsg.innerText = "¬°Demasiado tarde! Se llenaron los cupos.";
                        errorMsg.classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error(error);
                errorMsg.innerText = "Error m√°gico (de red). Intenta de nuevo.";
                errorMsg.classList.remove('hidden');
            }
            btn.disabled = false;
            btn.innerHTML = '<span class="text-xl">‚úíÔ∏è</span> <span class="tracking-widest font-bold">RECLAMAR LUGAR</span>';
        }

        function romanize(num) {
            const lookup = {M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};
            let roman = '', i;
            for ( i in lookup ) {
                while ( num >= lookup[i] ) { roman += i; num -= lookup[i]; }
            }
            return roman + '.';
        }
    </script>
    
    <script>
        const particleContainer = document.getElementById('particles');
        for (let i = 0; i < 30; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.width = p.style.height = (Math.random() * 4 + 2) + 'px';
            p.style.left = (Math.random() * 100) + 'vw';
            p.style.animationDuration = (Math.random() * 10 + 10) + 's';
            p.style.animationDelay = '-' + (Math.random() * 10) + 's';
            particleContainer.appendChild(p);
        }
        function nextSlide(n) {
            document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
            document.getElementById(`slide-${n}`).classList.add('active');
        }
    </script>
</body>
</html>
